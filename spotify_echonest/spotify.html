<script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.5/handlebars.js"></script>
<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
<!-- <link rel="stylesheet" type="text/css" href="style.css">
 -->
<div class="container">
    <h1>Search for an Artist</h1>
    <p>Type an artist name and click on "Search". Then, click on any album from the results to play 30 seconds of its first track.</p>
    <form id="search-form">
        <input type="text" id="query" value="" class="form-control" placeholder="Type an Artist Name"/>
        <input type="submit" id="search" class="btn btn-primary" value="Search" />
    </form>
    <div id="results"></div>
</div>
<script id="results-template" type="text/x-handlebars-template">
	<table><thead><tr>
	<td>Artist Name</td>
	<td>ID</td>
	<td>Popularity</td>
	<td>Followers</td>
	<td>Photo</td>
	</tr></thead><tbody>
	{{#each artists.items}}
	<tr>
		<td>{{name}}</td>
		<td>{{id}}</td>
		<td>{{popularity}}</td>
		<td>{{followers.total}}</td>
		<td><div style="border:1px solid red; background-image:url({{images.0.url}})" data-album-id="{{id}}" class="cover"></div></td>
    </tr>
	{{/each}}
	</tbody></table>
</script>

<script type="text/javascript">
// find template and compile it
var templateSource = document.getElementById('results-template').innerHTML,
    template = Handlebars.compile(templateSource),
    resultsPlaceholder = document.getElementById('results'),
    playingCssClass = 'playing',
    audioObject = null;

var fetchTracks = function (albumId, callback) {
    $.ajax({
        url: 'https://api.spotify.com/v1/albums/' + albumId,
        success: function (response) {
            callback(response);
        }
    });
};

var searchSongs = function (artistID, callback) {
  $.ajax({
      url: 'https://api.spotify.com/v1/artists/' + artistID + '/toptracks',
      success: function (response) {
          console.log(JSON.stringify(response));
      }
  })
}

var searchArtists = function (query, offset) {
    $.ajax({
        url: 'https://api.spotify.com/v1/search',
        data: {
            q: query,
            type: 'artist',
            limit: 50,
            offset: offset
        },
        success: function (response) {
            console.log(response)
            if(!response.artists.items.length)
                return;
            else{
              //*** CONSOLE OUTPUT
              $.each(response.artists.items, function(i, item){
                  console.log((i+offset) + ' - ' + item.name + ' - ' + item.id);
              });
              //*** HTML OUTPUT
              resultsPlaceholder.innerHTML = template(response);
              searchArtists(query, offset+50);
            }
        }
    });
};

document.getElementById('search-form').addEventListener('submit', function (e) {
    e.preventDefault();
    //document.getElementById('query').value = 'é™³'
    searchArtists(document.getElementById('query').value, 0);
    //document.getElementById('query').value = '2QcZxAgcs2I1q7CtCkl6MI'
    //searchSongs(document.getElementById('query').value);
}, false);
</script>
